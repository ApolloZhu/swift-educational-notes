<!doctype html><html lang=zh><meta charset=utf-8><meta name=generator content="Hugo 0.69.0"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=color-scheme content="light dark"><meta name=supported-color-schemes content="light dark"><title>使用要求带有 `Self` 或关联类型的协议&nbsp;&ndash;&nbsp;Swift 错误诊断教育文档</title><link rel=stylesheet href=/swift-educational-notes/css/core.min.ac866c7a8c660b15d3b9ad1c02ac572fde60ce20557d52d6e50e67f697c7c37feeadbc10696aa1c263aabfadd6b0b921.css integrity=sha384-rIZseoxmCxXTua0cAqxXL95gziBVfVLW5Q5n9pfHw3/urbwQaWqhwmOqv63WsLkh><link rel=apple-touch-icon sizes=180x180 href=https://apollozhu.github.io/swift-educational-notes/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://apollozhu.github.io/swift-educational-notes/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://apollozhu.github.io/swift-educational-notes/favicon-16x16.png><link rel=manifest href=https://apollozhu.github.io/swift-educational-notes/site.webmanifest><link rel=mask-icon href=https://apollozhu.github.io/swift-educational-notes/safari-pinned-tab.svg color=#5bbad5><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><body><div class=base-body><section id=header class="site header"><div class="header wrap"><span class="header left-side"><a class="site home" href=/swift-educational-notes/><img class="site logo" src=/swift-educational-notes/icon.png alt><span class="site name">Swift 错误诊断教育文档</span></a></span>
<span class="header right-side"><div class="nav wrap"><nav class=nav><a class="nav item" href=/swift-educational-notes/about/>关于</a><a class="nav item" href=https://github.com/ApolloZhu/swift-educational-notes target=_blank>GitHub</a></nav></div></span></div></section><div id=content><div class=article-container><section class="article header"><h1 class="article title">使用要求带有 <code>Self</code> 或关联类型的协议</h1><p class="article date">2020-03-02</p></section><article class="article markdown-body"><p>在 Swift 语言中，协议可以被用作类型，作为泛型约束，又或是不透明类型的一部分：</p><div class=highlight><pre class=chroma><code class=language-swift data-lang=swift><span class=c1>// CustomStringConvertible 可以被用作一个类型，</span>
<span class=kd>func</span> <span class=nf>foo</span><span class=p>(</span><span class=n>bar</span><span class=p>:</span> <span class=n>CustomStringConvertible</span><span class=p>)</span> <span class=p>{</span> <span class=cm>/* ... */</span> <span class=p>}</span>

<span class=c1>// ……或作为对泛型 &#39;T&#39; 的约束，</span>
<span class=kd>func</span> <span class=nf>bar</span><span class=p>&lt;</span><span class=n>T</span><span class=p>:</span> <span class=n>CustomStringConvertible</span><span class=p>&gt;(</span><span class=n>baz</span><span class=p>:</span> <span class=n>T</span><span class=p>)</span> <span class=p>{</span> <span class=cm>/* ... */</span> <span class=p>}</span>

<span class=c1>// ……或作为不透明类型的一部分。</span>
<span class=kd>func</span> <span class=nf>baz</span><span class=p>()</span> <span class=p>-&gt;</span> <span class=n>some</span> <span class=n>CustomStringConvertible</span> <span class=p>{</span> <span class=cm>/* ... */</span> <span class=p>}</span>
</code></pre></div><p>虽然 Swift 中所有的协议都可以被用作泛型约束以及不透明类型的一部分，但并不是所有的协议都能被用作类型。准确地说，如果一个协议的要求中使用了 <code>Self</code> 或者关联类型，那么它就不能被作为类型使用。<code>Identifiable</code> 就是这样的一个例子：其 <code>var id: ID { get }</code> 这个要求使用了 <code>ID</code> 这个关联类型。因此，下面这段代码是不能编译的：</p><div class=highlight><pre class=chroma><code class=language-swift data-lang=swift><span class=kd>func</span> <span class=nf>foo</span><span class=p>(</span><span class=n>bar</span><span class=p>:</span> <span class=n>Identifiable</span><span class=p>)</span> <span class=p>{</span> <span class=cm>/* ... */</span> <span class=p>}</span>
<span class=c1>// error: protocol &#39;Identifiable&#39; can only be used as a generic constraint because it has Self or associated type requirements</span>
</code></pre></div><p>之所以像 <code>Identifiable</code> 这样要求使用 <code>Self</code> 或者关联类型的协议不能被用作类型，是因为那样的类型实际上一般并没有什么用处。对于 <code>var id: ID { get }</code> 这样有 <code>Self</code> 或者关联类型的要求，既然我们并不知道其中的关联类型具体是什么，那自然也就无法使用。</p><p>在使用被 <code>Self</code> 或者关联类型要求约束的泛型协议时，不透明类型或者自己实现类型擦除能够解决大多数的问题。欲知详情，请参阅《The Swift Programming Language》中 <a href=https://swiftgg.gitbook.io/swift/swift-jiao-cheng/21_protocols target=_blank>协议</a>、<a href=https://swiftgg.gitbook.io/swift/swift-jiao-cheng/22_generics target=_blank>泛型</a> 和 <a href=https://swiftgg.gitbook.io/swift/swift-jiao-cheng/23_opaque_types target=_blank>不透明类型</a> 这些章节。</p></article><section class="article license">许可协议：<a href=https://github.com/apple/swift/blob/master/LICENSE.txt target=_blank>Apache 2.0 许可+运行时特许</a></section></div><section class="article navigation"><p><a class=link href=/swift-educational-notes/nominal-types/><span class=li>&rarr;</span>名义类型（nominal type）</a></p></section><section class="article discussion"><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"apollonian"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div><section id=footer class=footer><div class=footer-wrap><p class=copyright>Copyright © 2020 Apollo Zhu</p><p class=powerby><span>Powered by </span><a href=https://gohugo.io target=_blank>Hugo</a><span> and the </span><a href=https://themes.gohugo.io/hugo-notepadium/ target=_blank>Notepadium</a></p></div></section><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-72767473-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></div></body></html>